<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">6 posts tagged with &quot;workflow&quot; | Laravel Workflow</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://laravel-workflow.com/img/docusaurus.png"><meta data-rh="true" name="twitter:image" content="https://laravel-workflow.com/img/docusaurus.png"><meta data-rh="true" property="og:url" content="https://laravel-workflow.com/blog/tags/workflow"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="6 posts tagged with &quot;workflow&quot; | Laravel Workflow"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://laravel-workflow.com/blog/tags/workflow"><link data-rh="true" rel="alternate" href="https://laravel-workflow.com/blog/tags/workflow" hreflang="en"><link data-rh="true" rel="alternate" href="https://laravel-workflow.com/blog/tags/workflow" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GQ5HIWNNB3-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Laravel Workflow RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Laravel Workflow Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Laravel Workflow" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.0134d58d.css">
<link rel="preload" href="/assets/js/runtime~main.c6ba24a7.js" as="script">
<link rel="preload" href="/assets/js/main.8562ac8d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Laravel Workflow Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Laravel Workflow Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Laravel Workflow</b></a><a class="navbar__item navbar__link" href="/docs/installation">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/laravel-workflow/laravel-workflow" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/laravel-workflows-as-mcp-tools-for-ai-clients">Laravel Workflows as MCP Tools for AI Clients</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/building-reliable-agentic-loops-with-laravel-workflow-and-prismphp">Building Reliable Agentic Loops with Laravel Workflow and PrismPHP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/automating-qa-with-playwright-and-laravel-workflow">Automating QA with Playwright and Laravel Workflow</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/extending-laravel-workflow-to-support-spatie-laravel-tags">Extending Laravel Workflow to Support Spatie Laravel Tags</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/ai-image-moderation-with-laravel-workflow">AI Image Moderation with Laravel Workflow</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>6 posts tagged with &quot;workflow&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/laravel-workflows-as-mcp-tools-for-ai-clients">Laravel Workflows as MCP Tools for AI Clients</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-12-03T00:00:00.000Z" itemprop="datePublished">December 3, 2025</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/rmcdaniel.png" alt="Richard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Richard</span></a></div><small class="avatar__subtitle" itemprop="description">Core Team</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>The Model Context Protocol (MCP) is rapidly becoming the standard way for AI assistants like Claude, ChatGPT, and GitHub Copilot to interact with external tools and services. With Laravel MCP, you can expose your Laravel Workflow processes as callable tools that any MCP-compatible AI client can discover, invoke, and monitor.</p><p>In this post, we&#x27;ll show how to build an MCP server that allows AI clients to:</p><ul><li>Discover available workflows</li><li>Start workflows asynchronously</li><li>Poll for status and retrieve results</li></ul><p>This creates a powerful pattern where AI agents can orchestrate long-running, durable workflows, perfect for complex tasks that can&#x27;t complete in a single request.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-mcp--laravel-workflow">Why MCP + Laravel Workflow?<a class="hash-link" href="#why-mcp--laravel-workflow" title="Direct link to heading">​</a></h3><p>Laravel Workflow excels at durable, stateful execution. MCP excels at giving AI clients structured access to external capabilities. Together, they enable:</p><ul><li><strong>Async AI operations</strong>: Start a workflow, continue the conversation, check results later</li><li><strong>Reliable execution</strong>: Workflows survive crashes, retries, and long wait times</li><li><strong>Observability</strong>: Track every workflow through Waterline&#x27;s dashboard</li><li><strong>Stateless servers</strong>: The MCP server doesn&#x27;t hold state. Clients track workflow IDs</li></ul><p>This mirrors how humans delegate tasks: &quot;Start this report, I&#x27;ll check back later.&quot;</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-were-building">What We&#x27;re Building<a class="hash-link" href="#what-were-building" title="Direct link to heading">​</a></h3><p>We&#x27;ll create an MCP server with three tools:</p><table><thead><tr><th>Tool</th><th>Purpose</th></tr></thead><tbody><tr><td><code>list_workflows</code></td><td>Discover available workflows and view recent runs</td></tr><tr><td><code>start_workflow</code></td><td>Start a workflow and get a tracking ID</td></tr><tr><td><code>get_workflow_result</code></td><td>Check status and retrieve output when complete</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-by-step-implementation">Step-by-Step Implementation<a class="hash-link" href="#step-by-step-implementation" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-install-laravel-mcp">1. Install Laravel MCP<a class="hash-link" href="#1-install-laravel-mcp" title="Direct link to heading">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">composer</span><span class="token plain"> require laravel/mcp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan vendor:publish --tag</span><span class="token operator">=</span><span class="token plain">ai-routes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This gives you <code>routes/ai.php</code> where you&#x27;ll register your MCP server.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-the-mcp-server">2. Create the MCP Server<a class="hash-link" href="#2-create-the-mcp-server" title="Direct link to heading">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan make:mcp-server WorkflowServer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Configure it with instructions for the AI:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Mcp\Servers;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Mcp\Tools\GetWorkflowResultTool;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Mcp\Tools\ListWorkflowsTool;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Mcp\Tools\StartWorkflowTool;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Server;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class WorkflowServer extends Server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected string $name = &#x27;Laravel Workflow Server&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected string $version = &#x27;1.0.0&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected string $instructions = &lt;&lt;&lt;&#x27;MARKDOWN&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        This server allows you to start and monitor Laravel Workflows.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ## Typical Usage Pattern</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        1. Call `list_workflows` to see what workflows are available.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        2. Call `start_workflow` with the workflow name and arguments.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        3. Store the returned `workflow_id`.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        4. Call `get_workflow_result` until status is `WorkflowCompletedStatus`.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        5. Read the `output` field for the result.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ## Status Values</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        - `WorkflowCreatedStatus` - Workflow has been created</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        - `WorkflowPendingStatus` - Queued for execution</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        - `WorkflowRunningStatus` - Currently executing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        - `WorkflowWaitingStatus` - Waiting (timer, signal, etc.)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        - `WorkflowCompletedStatus` - Finished successfully</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        - `WorkflowFailedStatus` - Encountered an error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    MARKDOWN;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected array $tools = [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ListWorkflowsTool::class,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        StartWorkflowTool::class,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        GetWorkflowResultTool::class,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-create-the-start-workflow-tool">3. Create the Start Workflow Tool<a class="hash-link" href="#3-create-the-start-workflow-tool" title="Direct link to heading">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan make:mcp-tool StartWorkflowTool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Mcp\Tools;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Contracts\JsonSchema\JsonSchema;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Support\Arr;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Request;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Server\Tool;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Workflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\WorkflowStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class StartWorkflowTool extends Tool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected string $description = &lt;&lt;&lt;&#x27;MARKDOWN&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Start a Laravel Workflow asynchronously and return its workflow ID.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        The workflow will execute in the background on the queue. Use the</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        `get_workflow_result` tool to poll for status and retrieve results</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        once the workflow completes.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    MARKDOWN;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function handle(Request $request): Response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $data = $request-&gt;validate([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;workflow&#x27; =&gt; [&#x27;required&#x27;, &#x27;string&#x27;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;args&#x27; =&gt; [&#x27;nullable&#x27;, &#x27;array&#x27;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;external_id&#x27; =&gt; [&#x27;nullable&#x27;, &#x27;string&#x27;, &#x27;max:255&#x27;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflowKey = $data[&#x27;workflow&#x27;];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $args = Arr::get($data, &#x27;args&#x27;, []);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $externalId = $data[&#x27;external_id&#x27;] ?? null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflowClass = $this-&gt;resolveWorkflowClass($workflowKey);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if ($workflowClass === null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return Response::error(&quot;Unknown workflow: {$workflowKey}&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (! class_exists($workflowClass) || ! is_subclass_of($workflowClass, Workflow::class)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return Response::error(&quot;Invalid workflow class: {$workflowClass}&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $stub = WorkflowStub::make($workflowClass);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $stub-&gt;start(...array_values($args));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $status = $stub-&gt;status();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $statusName = is_object($status) ? class_basename($status) : class_basename((string) $status);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return Response::json([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;workflow_id&#x27; =&gt; $stub-&gt;id(),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;workflow&#x27; =&gt; $workflowKey,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;status&#x27; =&gt; $statusName,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;external_id&#x27; =&gt; $externalId,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;message&#x27; =&gt; &#x27;Workflow started. Use get_workflow_result to poll status.&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected function resolveWorkflowClass(string $key): ?string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $mapped = config(&quot;workflow_mcp.workflows.{$key}&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if ($mapped !== null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return $mapped;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (config(&#x27;workflow_mcp.allow_fqcn&#x27;, false) &amp;&amp; str_contains($key, &#x27;\\&#x27;)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return $key;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function schema(JsonSchema $schema): array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflows = implode(&#x27;, &#x27;, array_keys(config(&#x27;workflow_mcp.workflows&#x27;, [])));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;workflow&#x27; =&gt; $schema-&gt;string()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                -&gt;description(&quot;The workflow to start. Available: {$workflows}&quot;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;args&#x27; =&gt; $schema-&gt;object()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                -&gt;description(&#x27;Arguments for the workflow execute() method.&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;external_id&#x27; =&gt; $schema-&gt;string()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                -&gt;description(&#x27;Optional idempotency key for tracking.&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-create-the-get-result-tool">4. Create the Get Result Tool<a class="hash-link" href="#4-create-the-get-result-tool" title="Direct link to heading">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan make:mcp-tool GetWorkflowResultTool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Mcp\Tools;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Models\StoredWorkflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Contracts\JsonSchema\JsonSchema;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Request;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Server\Tool;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\States\WorkflowCompletedStatus;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\States\WorkflowFailedStatus;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\WorkflowStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class GetWorkflowResultTool extends Tool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected string $description = &lt;&lt;&lt;&#x27;MARKDOWN&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Fetch the status and, if completed, the output of a Laravel Workflow.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Use the workflow_id returned by `start_workflow` to check progress.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Once status is `WorkflowCompletedStatus`, the output field contains the result.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    MARKDOWN;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function handle(Request $request): Response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $data = $request-&gt;validate([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;workflow_id&#x27; =&gt; [&#x27;required&#x27;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflowId = $data[&#x27;workflow_id&#x27;];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $stored = StoredWorkflow::find($workflowId);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (! $stored) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return Response::json([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &#x27;found&#x27; =&gt; false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &#x27;message&#x27; =&gt; &quot;Workflow {$workflowId} not found.&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflow = WorkflowStub::load($workflowId);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $status = $workflow-&gt;status();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $statusName = is_object($status) ? class_basename($status) : class_basename((string) $status);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $running = $workflow-&gt;running();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $result = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $error = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (! $running &amp;&amp; str_contains($statusName, &#x27;Completed&#x27;)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $result = $workflow-&gt;output();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (! $running &amp;&amp; str_contains($statusName, &#x27;Failed&#x27;)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $exception = $stored-&gt;exceptions()-&gt;latest()-&gt;first();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $error = $exception?-&gt;exception ?? &#x27;Unknown error&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return Response::json([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;found&#x27; =&gt; true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;workflow_id&#x27; =&gt; $workflowId,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;status&#x27; =&gt; $statusName,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;running&#x27; =&gt; $running,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;output&#x27; =&gt; $result,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;error&#x27; =&gt; $error,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;created_at&#x27; =&gt; $stored-&gt;created_at?-&gt;toIso8601String(),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;updated_at&#x27; =&gt; $stored-&gt;updated_at?-&gt;toIso8601String(),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function schema(JsonSchema $schema): array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;workflow_id&#x27; =&gt; $schema-&gt;string()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                -&gt;description(&#x27;The workflow ID returned by start_workflow.&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-create-the-list-workflows-tool">5. Create the List Workflows Tool<a class="hash-link" href="#5-create-the-list-workflows-tool" title="Direct link to heading">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan make:mcp-tool ListWorkflowsTool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Mcp\Tools;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Models\StoredWorkflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Contracts\JsonSchema\JsonSchema;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Request;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Server\Tool;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class ListWorkflowsTool extends Tool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected string $description = &lt;&lt;&lt;&#x27;MARKDOWN&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        List available workflow types and optionally show recent workflow runs.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Use this to discover what workflows can be started, or to see</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        the status of recent executions.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    MARKDOWN;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function handle(Request $request): Response</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $data = $request-&gt;validate([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;show_recent&#x27; =&gt; [&#x27;nullable&#x27;, &#x27;boolean&#x27;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;limit&#x27; =&gt; [&#x27;nullable&#x27;, &#x27;integer&#x27;, &#x27;min:1&#x27;, &#x27;max:50&#x27;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;status&#x27; =&gt; [&#x27;nullable&#x27;, &#x27;string&#x27;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $showRecent = $data[&#x27;show_recent&#x27;] ?? false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $limit = $data[&#x27;limit&#x27;] ?? 10;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $statusFilter = $data[&#x27;status&#x27;] ?? null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $availableWorkflows = [];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        foreach (config(&#x27;workflow_mcp.workflows&#x27;, []) as $key =&gt; $class) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $availableWorkflows[] = [&#x27;key&#x27; =&gt; $key, &#x27;class&#x27; =&gt; $class];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $response = [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;available_workflows&#x27; =&gt; $availableWorkflows,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if ($showRecent) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $query = StoredWorkflow::query()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                -&gt;orderBy(&#x27;created_at&#x27;, &#x27;desc&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                -&gt;limit($limit);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if ($statusFilter) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                $query-&gt;where(&#x27;status&#x27;, &#x27;like&#x27;, &quot;%{$statusFilter}%&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $response[&#x27;recent_workflows&#x27;] = $query-&gt;get()-&gt;map(function ($w) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                $status = $w-&gt;status;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                $statusName = is_object($status) ? class_basename($status) : class_basename((string) $status);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                return [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &#x27;id&#x27; =&gt; $w-&gt;id,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &#x27;class&#x27; =&gt; $w-&gt;class,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &#x27;status&#x27; =&gt; $statusName,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &#x27;created_at&#x27; =&gt; $w-&gt;created_at?-&gt;toIso8601String(),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return Response::json($response);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function schema(JsonSchema $schema): array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;show_recent&#x27; =&gt; $schema-&gt;boolean()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                -&gt;description(&#x27;Include recent workflow runs in response.&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;limit&#x27; =&gt; $schema-&gt;integer()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                -&gt;description(&#x27;Max recent workflows to return (default: 10).&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;status&#x27; =&gt; $schema-&gt;string()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                -&gt;description(&#x27;Filter by status (e.g., &quot;Completed&quot;, &quot;Failed&quot;).&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-configure-available-workflows">6. Configure Available Workflows<a class="hash-link" href="#6-configure-available-workflows" title="Direct link to heading">​</a></h4><p>Create <code>config/workflow_mcp.php</code> to whitelist which workflows AI clients can start:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">return [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;allow_fqcn&#x27; =&gt; env(&#x27;WORKFLOW_MCP_ALLOW_FQCN&#x27;, false),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;workflows&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;simple&#x27; =&gt; App\Workflows\Simple\SimpleWorkflow::class,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;prism&#x27; =&gt; App\Workflows\Prism\PrismWorkflow::class,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This prevents arbitrary class execution. Only mapped workflows are accessible.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="7-register-the-mcp-server">7. Register the MCP Server<a class="hash-link" href="#7-register-the-mcp-server" title="Direct link to heading">​</a></h4><p>Update <code>routes/ai.php</code>:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Mcp\Servers\WorkflowServer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Laravel\Mcp\Facades\Mcp;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Mcp::web(&#x27;/mcp/workflows&#x27;, WorkflowServer::class);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-ai-clients">Connecting AI Clients<a class="hash-link" href="#connecting-ai-clients" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="vs-code--github-copilot">VS Code / GitHub Copilot<a class="hash-link" href="#vs-code--github-copilot" title="Direct link to heading">​</a></h4><p>Create <code>.vscode/mcp.json</code> in your project:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;servers&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;laravel-workflow&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;http&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;url&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;http://localhost/mcp/workflows&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This configuration works for both local development and GitHub Codespaces. In Codespaces, the VS Code server runs inside the container, so <code>localhost</code> correctly reaches the Laravel server without needing public ports or the <code>*.app.github.dev</code> URL.</p><p>After reloading VS Code (Cmd/Ctrl+Shift+P → &quot;Developer: Reload Window&quot;), Copilot can use the workflow tools directly in chat.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-world-usage">Real-World Usage<a class="hash-link" href="#real-world-usage" title="Direct link to heading">​</a></h3><p>Once connected, you can have natural conversations with your AI assistant:</p><blockquote><p><strong>You:</strong> &quot;What workflows are available?&quot;</p><p><strong>AI:</strong> <em>calls list_workflows</em> &quot;I found 2 workflows: <code>simple</code> and <code>prism</code>.&quot;</p></blockquote><blockquote><p><strong>You:</strong> &quot;Start the prism workflow&quot;</p><p><strong>AI:</strong> <em>calls start_workflow</em> &quot;Started workflow ID 42. I&#x27;ll check its status.&quot;</p></blockquote><blockquote><p><strong>AI:</strong> <em>calls get_workflow_result</em> &quot;The workflow completed! Here&#x27;s the generated user profile: { name: &#x27;Elena&#x27;, hobbies: <!-- -->[...]<!-- --> }&quot;</p></blockquote><p>This creates a seamless experience where AI assistants can orchestrate complex, long-running operations while keeping the user informed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-makes-this-pattern-powerful">What Makes This Pattern Powerful<a class="hash-link" href="#what-makes-this-pattern-powerful" title="Direct link to heading">​</a></h3><ul><li><strong>Durability</strong>: Workflows survive server restarts and network failures</li><li><strong>Async by design</strong>: AI clients don&#x27;t block waiting for completion</li><li><strong>Observable</strong>: Every workflow is tracked in Waterline&#x27;s dashboard</li><li><strong>Secure</strong>: Whitelist-based workflow access prevents arbitrary execution</li><li><strong>Stateless MCP</strong>: The server holds no state. Clients track workflow IDs</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="try-it-now-in-your-browser">Try It Now in Your Browser<a class="hash-link" href="#try-it-now-in-your-browser" title="Direct link to heading">​</a></h3><p>This MCP integration is included and pre-configured in the Laravel Workflow <a href="https://github.com/laravel-workflow/sample-app" target="_blank" rel="noopener noreferrer">Sample App</a>.</p><p>To try it:</p><ol><li>Open the sample-app repo on GitHub</li><li>Click <strong>Code</strong> → <strong>Codespaces</strong> → <strong>Create codespace on main</strong></li><li>Wait for the environment to build</li><li>Setup the app and start the queue worker:<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan app:init</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan queue:work</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>Ask your AI to list and run workflows!</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="where-to-go-from-here">Where to Go From Here<a class="hash-link" href="#where-to-go-from-here" title="Direct link to heading">​</a></h3><p>You can extend this pattern to:</p><ul><li><strong>Parameterized workflows</strong>: Pass user input to workflow arguments</li><li><strong>Webhook notifications</strong>: Push completion events instead of polling</li><li><strong>Workflow signals</strong>: Let AI clients send signals to waiting workflows</li><li><strong>Progress streaming</strong>: Use SSE to stream workflow progress in real-time</li><li><strong>Multi-step agents</strong>: Chain multiple workflows together in a conversation</li></ul><p>The combination of Laravel Workflow&#x27;s durable execution and MCP&#x27;s tool protocol creates a foundation for truly capable AI agents that can handle real-world complexity.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ai">ai</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/workflow">workflow</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/mcp">mcp</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/agents">agents</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/building-reliable-agentic-loops-with-laravel-workflow-and-prismphp">Building Reliable Agentic Loops with Laravel Workflow and PrismPHP</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-07-10T00:00:00.000Z" itemprop="datePublished">July 10, 2025</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/rmcdaniel.png" alt="Richard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Richard</span></a></div><small class="avatar__subtitle" itemprop="description">Core Team</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://cdn.statically.io/img/prismphp.com/assets/prism-logo.webp" alt="captionless image" class="img_ev3q"></p><p>Laravel Workflow is a powerful tool for orchestrating long-running, stateful workflows in PHP. Paired with <a href="https://prismphp.com/" target="_blank" rel="noopener noreferrer">PrismPHP</a>, it becomes a compelling foundation for building reliable AI agents that not only generate structured data but verify and retry until results meet strict real-world constraints.</p><p>In this post, we’ll show how to use Laravel Workflow + Prism to create an agentic loop that:</p><ul><li>Generates structured data using an LLM</li><li>Validates the result against custom rules</li><li>Retries automatically until the result passes</li></ul><p>You can try this exact workflow right now in your browser with no setup or coding required. Just click the button in the Laravel Workflow <a href="https://github.com/laravel-workflow/sample-app" target="_blank" rel="noopener noreferrer">Sample App</a> and launch a GitHub Codespace to run it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-were-building">What We’re Building<a class="hash-link" href="#what-were-building" title="Direct link to heading">​</a></h3><p>We’ll create a workflow that asks an LLM to generate a user profile with hobbies. Then we’ll validate that:</p><ul><li>The name is present</li><li>At least one hobby is defined</li><li>The name starts with a vowel</li></ul><p>If the result fails validation, we loop back to the LLM and regenerate. All of this is durable, asynchronous, and tracked through stateful events.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-by-step-example">Step-by-Step Example<a class="hash-link" href="#step-by-step-example" title="Direct link to heading">​</a></h3><ol><li>Console Command to Trigger the Workflow</li></ol><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Workflows\Prism\PrismWorkflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Console\Command;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\WorkflowStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Prism extends Command</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected $signature = &#x27;app:prism&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected $description = &#x27;Runs a Prism AI workflow&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function handle()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflow = WorkflowStub::make(PrismWorkflow::class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflow-&gt;start();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        while ($workflow-&gt;running());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $user = $workflow-&gt;output();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $this-&gt;info(&#x27;Generated User:&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $this-&gt;info(json_encode($user, JSON_PRETTY_PRINT));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Define the Workflow Logic</li></ol><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\ActivityStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Workflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class PrismWorkflow extends Workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        do {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $user = yield ActivityStub::make(GenerateUserActivity::class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $valid = yield ActivityStub::make(ValidateUserActivity::class, $user);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } while (!$valid);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return $user;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a classic agent loop. If validation fails, we prompt again automatically.</p><ol start="3"><li>Generate Structured User Data with PrismPHP</li></ol><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Prism\Prism\Prism;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Prism\Prism\Enums\Provider;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Prism\Prism\Schema\ArraySchema;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Prism\Prism\Schema\ObjectSchema;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Prism\Prism\Schema\StringSchema;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Activity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class GenerateUserActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $schema = new ObjectSchema(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            name: &#x27;user&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            description: &#x27;A user profile with their hobbies&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            properties: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                new StringSchema(&#x27;name&#x27;, &#x27;The user\&#x27;s full name&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                new ArraySchema(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    name: &#x27;hobbies&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    description: &#x27;The user\&#x27;s list of hobbies&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    items: new ObjectSchema(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        name: &#x27;hobby&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        description: &#x27;A detailed hobby entry&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        properties: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            new StringSchema(&#x27;name&#x27;, &#x27;The name of the hobby&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            new StringSchema(&#x27;description&#x27;, &#x27;A brief description of the hobby&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        requiredFields: [&#x27;name&#x27;, &#x27;description&#x27;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            requiredFields: [&#x27;name&#x27;, &#x27;hobbies&#x27;]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $response = Prism::structured()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            -&gt;using(Provider::OpenAI, &#x27;gpt-4o&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            -&gt;withSchema($schema)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            -&gt;withPrompt(&#x27;Use names from many languages and vary first initials.&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            -&gt;asStructured();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return $response-&gt;structured;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Validate Business Logic</li></ol><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Activity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class ValidateUserActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute($user)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (empty($user[&#x27;name&#x27;]) || !is_array($user[&#x27;hobbies&#x27;]) || count($user[&#x27;hobbies&#x27;]) === 0) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        foreach ($user[&#x27;hobbies&#x27;] as $hobby) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (empty($hobby[&#x27;name&#x27;]) || empty($hobby[&#x27;description&#x27;])) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                return false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Extra Validation: The user&#x27;s name must start with a vowel.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (!in_array(strtoupper($user[&#x27;name&#x27;][0]), [&#x27;A&#x27;, &#x27;E&#x27;, &#x27;I&#x27;, &#x27;O&#x27;, &#x27;U&#x27;])) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return true;  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-makes-this-pattern-powerful">What Makes This Pattern Powerful<a class="hash-link" href="#what-makes-this-pattern-powerful" title="Direct link to heading">​</a></h3><p>This design pattern is what you’d call a reliable agentic loop:</p><ul><li>LLM generation via Prism</li><li>Validation &amp; retry via Laravel Workflow</li><li>State persistence for crash recovery or inspection</li><li>Observability via Waterline</li></ul><p>It’s perfect for AI applications where accuracy, safety, and traceability are required.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="try-it-now-in-your-browser">Try It Now in Your Browser<a class="hash-link" href="#try-it-now-in-your-browser" title="Direct link to heading">​</a></h3><p>We’ve bundled this workflow into the official Laravel Workflow <a href="https://github.com/laravel-workflow/sample-app" target="_blank" rel="noopener noreferrer">Sample App</a>, which runs in GitHub Codespaces.</p><p>To launch it:</p><ol><li>Open the sample-app repo</li><li>Click the “Code” button → “Codespaces” → “Create codespace on main”</li><li>Wait a few seconds for setup</li><li>Set your OPENAI_API_KEY</li><li>Run:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan migrate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan queue:work</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>In a second terminal:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan app:prism</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will see the queue working and eventually see the validated output.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="where-to-go-from-here">Where to Go From Here<a class="hash-link" href="#where-to-go-from-here" title="Direct link to heading">​</a></h3><p>You can easily adapt this pattern to:</p><ul><li>AI agents for form filling</li><li>Data scraping and validation</li><li>Content generation with retry policies</li><li>Moderation and review queues</li></ul><p>Each step remains reliable and traceable thanks to Laravel Workflow’s durable execution model.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ai">ai</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/workflow">workflow</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/agents">agents</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/agentic">agentic</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/automating-qa-with-playwright-and-laravel-workflow">Automating QA with Playwright and Laravel Workflow</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-02-07T00:00:00.000Z" itemprop="datePublished">February 7, 2025</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/rmcdaniel.png" alt="Richard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Richard</span></a></div><small class="avatar__subtitle" itemprop="description">Core Team</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b6eXVs5J3aRNzYAiqnS9Vw.png" alt="captionless image" class="img_ev3q"></p><p>Have you ever spent hours tracking down a frontend bug that only happens in production? When working with web applications, debugging frontend issues can be challenging. Console errors and unexpected UI behaviors often require careful inspection and reproducible test cases. Wouldn’t it be great if you could automate this process, capture errors, and even record a video of the session for later analysis?</p><p>With <strong>Playwright</strong> and <strong>Laravel Workflow</strong>, you can achieve just that! In this post, I’ll walk you through an automated workflow that:</p><ul><li>Loads a webpage and captures console errors.</li><li>Records a video of the session.</li><li>Converts the video to an MP4 format for easy sharing.</li><li>Runs seamlessly in a <strong>GitHub Codespace</strong>.</li></ul><h1>The Stack</h1><ul><li><strong>Playwright</strong>: A powerful browser automation tool for testing web applications.</li><li><strong>Laravel Workflow</strong>: A durable workflow engine for handling long-running, distributed processes.</li><li><strong>FFmpeg</strong>: Used to convert Playwright’s WebM recordings to MP4 format.</li></ul><p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2AcR_sLHGToBWQx-SCSPHA.png" alt="captionless image" class="img_ev3q"></p><h1>1. Capturing Errors and Video with Playwright</h1><p>The Playwright script automates a browser session, navigates to a given URL, and logs any console errors. It also records a video of the entire session.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> chromium </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;playwright&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports">path</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;path&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports">fs</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;fs&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> url </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">argv</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> videoDir </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">resolve</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./videos&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">fs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">existsSync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">videoDir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">mkdirSync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">videoDir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token literal-property property">recursive</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> browser </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> chromium</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">launch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token literal-property property">args</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;--no-sandbox&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> context </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> browser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">newContext</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token literal-property property">recordVideo</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token literal-property property">dir</span><span class="token operator">:</span><span class="token plain"> videoDir </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> page </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">newPage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> errors </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;console&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token parameter">msg</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;error&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            errors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">text</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">goto</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token literal-property property">waitUntil</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;networkidle&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token literal-property property">timeout</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">10000</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        errors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token template-string string" style="color:rgb(255, 121, 198)">Page load error: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token template-string interpolation">error</span><span class="token template-string interpolation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token template-string interpolation property-access">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token template-string template-punctuation string" style="color:rgb(255, 121, 198)">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> video </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">video</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">await</span><span class="token plain"> browser</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">stringify</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> errors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> video </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>2. Running the Workflow</h1><p>A Laravel console command (<code>php artisan app:playwright</code>) starts the workflow which:</p><ul><li>Runs the Playwright script and collects errors.</li><li>Converts the video from <code>.webm</code> to <code>.mp4</code> using FFmpeg.</li><li>Returns the errors and the final video file path.</li></ul><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Console\Commands;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Workflows\Playwright\CheckConsoleErrorsWorkflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Console\Command;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\WorkflowStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Playwright extends Command</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected $signature = &#x27;app:playwright&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected $description = &#x27;Runs a playwright workflow&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function handle()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflow = WorkflowStub::make(CheckConsoleErrorsWorkflow::class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflow-&gt;start(&#x27;https://example.com&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        while ($workflow-&gt;running());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $this-&gt;info($workflow-&gt;output()[&#x27;mp4&#x27;]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>3. The Workflow</h1><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Workflows\Playwright;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\ActivityStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Workflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class CheckConsoleErrorsWorkflow extends Workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute(string $url)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $result = yield ActivityStub::make(CheckConsoleErrorsActivity::class, $url);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $mp4 = yield ActivityStub::make(ConvertVideoActivity::class, $result[&#x27;video&#x27;]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;errors&#x27; =&gt; $result[&#x27;errors&#x27;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;mp4&#x27; =&gt; $mp4,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>4. Running Playwright</h1><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Workflows\Playwright;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Support\Facades\Process;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Activity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class CheckConsoleErrorsActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute(string $url)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $result = Process::run([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;node&#x27;, base_path(&#x27;playwright-script.js&#x27;), $url</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ])-&gt;throw();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return json_decode($result-&gt;output(), true);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>5. Video Conversion with FFmpeg</h1><p>The Playwright recording is stored in WebM format, but we need an MP4 for wider compatibility. Laravel Workflow runs this process asynchronously.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Workflows\Playwright;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Support\Facades\Process;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Activity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class ConvertVideoActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute(string $webm)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $mp4 = str_replace(&#x27;.webm&#x27;, &#x27;.mp4&#x27;, $webm);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Process::run([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &#x27;ffmpeg&#x27;, &#x27;-i&#x27;, $webm, &#x27;-c:v&#x27;, &#x27;libx264&#x27;, &#x27;-preset&#x27;, &#x27;fast&#x27;, &#x27;-crf&#x27;, &#x27;23&#x27;, &#x27;-c:a&#x27;, &#x27;aac&#x27;, &#x27;-b:a&#x27;, &#x27;128k&#x27;, $mp4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ])-&gt;throw();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        unlink($webm);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return $mp4;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-try-it-out-in-a-github-codespace">🚀 Try It Out in a GitHub Codespace<a class="hash-link" href="#-try-it-out-in-a-github-codespace" title="Direct link to heading">​</a></h2><p>You don’t need to set up anything on your local machine. Everything is already configured in the <strong>Laravel Workflow Sample App</strong>.</p><h1>Steps to Run the Playwright Workflow</h1><ul><li>Open the <strong>Laravel Workflow Sample App</strong> on GitHub: <a href="https://github.com/laravel-workflow/sample-app" target="_blank" rel="noopener noreferrer">laravel-workflow/sample-app</a></li><li>Click <strong>“Create codespace on main”</strong> to start a pre-configured development environment.</li></ul><p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*063hPvkrvDQP6gU-VYb0Ug.png" alt="captionless image" class="img_ev3q"></p><ul><li>Once the Codespace is ready, run the following commands in the terminal:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan migrate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan queue:work</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Then open a second terminal and run this command:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan app:playwright</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That’s it! The workflow will execute, capture console errors, record a video, and convert it to MP4. You can find the video in the videos folder. Take a look at the sample app’s README.md for more information on other workflows and how to view the Waterline UI.</p><h1>Conclusion</h1><p>By integrating Playwright with Laravel Workflow, we’ve automated frontend error detection and debugging. This setup allows teams to quickly identify and resolve issues, all while leveraging Laravel’s queue system to run tasks asynchronously.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-next-steps">🔗 <strong>Next Steps</strong><a class="hash-link" href="#-next-steps" title="Direct link to heading">​</a></h2><ul><li>Check out the <a href="https://github.com/laravel-workflow/laravel-workflow" target="_blank" rel="noopener noreferrer">Laravel Workflow repo</a> on GitHub.</li><li>Explore more workflows in the <a href="https://github.com/laravel-workflow/sample-app" target="_blank" rel="noopener noreferrer">sample app</a>.</li><li>Join the community and share your workflows!</li></ul><p>Happy automating! 🚀</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/playwright">playwright</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/workflow">workflow</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/automation">automation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/qa">qa</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/testing">testing</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/extending-laravel-workflow-to-support-spatie-laravel-tags">Extending Laravel Workflow to Support Spatie Laravel Tags</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-08-28T00:00:00.000Z" itemprop="datePublished">August 28, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/rmcdaniel.png" alt="Richard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Richard</span></a></div><small class="avatar__subtitle" itemprop="description">Core Team</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4YFhkvL6nZ3ny4NjGe6sMQ.png" alt="captionless image" class="img_ev3q"></p><p>One of the strengths of the Laravel ecosystem is its flexibility, thanks to a myriad of community-driven packages that enhance the framework’s capabilities. The <code>laravel-workflow</code> and <code>spatie/laravel-tags</code> packages are two such examples, and in this post, we&#x27;ll integrate them together to make workflows taggable.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation-instructions">Installation Instructions<a class="hash-link" href="#installation-instructions" title="Direct link to heading">​</a></h2><p>Before diving into the code, let’s ensure both libraries are properly installed:</p><ol><li>Install <a href="https://github.com/laravel-workflow/laravel-workflow" target="_blank" rel="noopener noreferrer">Laravel Workflow</a> and <a href="https://github.com/spatie/laravel-tags" target="_blank" rel="noopener noreferrer">Spatie Laravel Tags</a>.</li></ol><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">composer require laravel-workflow/laravel-workflow spatie/laravel-tags</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Both packages include migrations that must be published.</li></ol><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan vendor:publish --provider=&quot;Workflow\Providers\WorkflowServiceProvider&quot; --tag=&quot;migrations&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan vendor:publish --provider=&quot;Spatie\Tags\TagsServiceProvider&quot; --tag=&quot;tags-migrations&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Run the migrations.</li></ol><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan migrate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="publishing-configuration">Publishing Configuration<a class="hash-link" href="#publishing-configuration" title="Direct link to heading">​</a></h2><p>To extend Laravel Workflow, publish its configuration file:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan vendor:publish --provider=&quot;Workflow\Providers\WorkflowServiceProvider&quot; --tag=&quot;config&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="extending-workflows-to-support-tags">Extending Workflows to Support Tags<a class="hash-link" href="#extending-workflows-to-support-tags" title="Direct link to heading">​</a></h2><p>We need to extend the <code>StoredWorkflow</code> model of <code>laravel-workflow</code> to support tagging.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Spatie\Tags\HasTags;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Models\StoredWorkflow as BaseStoredWorkflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\WorkflowStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class StoredWorkflow extends BaseStoredWorkflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    use HasTags;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public static function tag(WorkflowStub $workflow, $tag): void</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $storedWorkflow = static::find($workflow-&gt;id());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if ($storedWorkflow) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $storedWorkflow-&gt;attachTag($tag);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public static function findByTag($tag): ?WorkflowStub</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $storedWorkflow = static::withAnyTags([$tag])-&gt;first();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if ($storedWorkflow) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return WorkflowStub::fromStoredWorkflow($storedWorkflow);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="modify-the-configuration">Modify the Configuration<a class="hash-link" href="#modify-the-configuration" title="Direct link to heading">​</a></h2><p>In <code>config/workflow.php</code>, update this line:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&#x27;stored_workflow_model&#x27; =&gt; Workflow\Models\StoredWorkflow::class,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&#x27;stored_workflow_model&#x27; =&gt; App\Models\StoredWorkflow::class,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This ensures Laravel Workflow uses the extended model.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-tagged-workflows">Running Tagged Workflows<a class="hash-link" href="#running-tagged-workflows" title="Direct link to heading">​</a></h2><p>With the taggable <code>StoredWorkflow</code> ready, create a console command to create, tag, retrieve, and run a workflow.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Console\Commands;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Models\StoredWorkflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Workflows\Simple\SimpleWorkflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Console\Command;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\WorkflowStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Workflow extends Command</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected $signature = &#x27;workflow&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected $description = &#x27;Runs a workflow&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function handle()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Create a workflow and tag it</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflow = WorkflowStub::make(SimpleWorkflow::class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        StoredWorkflow::tag($workflow, &#x27;tag1&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Find the workflow by tag and start it</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflow = StoredWorkflow::findByTag(&#x27;tag1&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflow-&gt;start();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        while ($workflow-&gt;running());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $this-&gt;info($workflow-&gt;output());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>By integrating <code>laravel-workflow</code> with <code>spatie/laravel-tags</code>, we&#x27;ve enabled tagging for workflows, making management more intuitive in larger applications. Thanks to Laravel’s extensible nature, endless possibilities await developers leveraging these powerful packages.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/laravel">laravel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/workflow">workflow</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/spatie">spatie</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tags">tags</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/automation">automation</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/ai-image-moderation-with-laravel-workflow">AI Image Moderation with Laravel Workflow</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-08-20T00:00:00.000Z" itemprop="datePublished">August 20, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/rmcdaniel.png" alt="Richard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Richard</span></a></div><small class="avatar__subtitle" itemprop="description">Core Team</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sz-f9McEdB5UIlr55GOjyw.png" alt="captionless image" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>Before we begin, let’s understand the scenario. We are building an image moderation system where:</p><ol><li>Every image undergoes an initial AI check to determine if it’s safe.</li><li>If the AI deems the image unsafe, it’s automatically logged and deleted.</li><li>If it’s potentially safe, a human moderator is alerted to further review the image. They have the option to approve or reject the image.</li><li>Approved images are moved to a public location, whereas rejected images are deleted.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="laravel-workflow">Laravel Workflow<a class="hash-link" href="#laravel-workflow" title="Direct link to heading">​</a></h2><p>Laravel Workflow is designed to streamline and organize complex processes in applications. It allows developers to define, manage, and execute workflows seamlessly. You can find installation instructions <a href="https://github.com/laravel-workflow/laravel-workflow" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="clarifai-api">ClarifAI API<a class="hash-link" href="#clarifai-api" title="Direct link to heading">​</a></h2><p>ClarifAI provides AI-powered moderation tools for analyzing visual content. They offer a <a href="https://www.clarifai.com/pricing" target="_blank" rel="noopener noreferrer">free plan</a> with up to 1,000 actions per month.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-store-your-credentials-in-env">1. Store your credentials in <code>.env</code>.<a class="hash-link" href="#1-store-your-credentials-in-env" title="Direct link to heading">​</a></h3><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CLARIFAI_API_KEY=key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CLARIFAI_APP=my-application</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CLARIFAI_WORKFLOW=my-workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CLARIFAI_USER=username</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-add-the-service-to-configservicesphp">2. Add the service to <code>config/services.php</code>.<a class="hash-link" href="#2-add-the-service-to-configservicesphp" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&#x27;clarifai&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;api_key&#x27; =&gt; env(&#x27;CLARIFAI_API_KEY&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;app&#x27; =&gt; env(&#x27;CLARIFAI_APP&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;workflow&#x27; =&gt; env(&#x27;CLARIFAI_WORKFLOW&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;user&#x27; =&gt; env(&#x27;CLARIFAI_USER&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">],</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-create-a-service-at-appservicesclarifaiphp">3. Create a service at <code>app/Services/ClarifAI.php</code>.<a class="hash-link" href="#3-create-a-service-at-appservicesclarifaiphp" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Services;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Support\Facades\Http;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class ClarifAI</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private $apiKey;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private $apiUrl;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function __construct()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $app = config(&#x27;services.clarifai.app&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $workflow = config(&#x27;services.clarifai.workflow&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $user = config(&#x27;services.clarifai.user&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $this-&gt;apiKey = config(&#x27;services.clarifai.api_key&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $this-&gt;apiUrl = &quot;https://api.clarifai.com/v2/users/{$user}/apps/{$app}/workflows/{$workflow}/results/&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function checkImage(string $image): bool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $response = Http::withToken($this-&gt;apiKey, &#x27;Key&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            -&gt;post($this-&gt;apiUrl, [&#x27;inputs&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                [&#x27;data&#x27; =&gt; [&#x27;image&#x27; =&gt; [&#x27;base64&#x27; =&gt; base64_encode($image)]]],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ]]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return collect($response-&gt;json(&#x27;results.0.outputs.0.data.concepts&#x27;, []))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            -&gt;filter(fn ($value) =&gt; $value[&#x27;name&#x27;] === &#x27;safe&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            -&gt;map(fn ($value) =&gt; round((float) $value[&#x27;value&#x27;]) &gt; 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            -&gt;first() ?? false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-workflow">Creating the Workflow<a class="hash-link" href="#creating-the-workflow" title="Direct link to heading">​</a></h2><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Workflows;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\ActivityStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\SignalMethod;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\WorkflowStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Workflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class ImageModerationWorkflow extends Workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private bool $approved = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private bool $rejected = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    #[SignalMethod]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function approve()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $this-&gt;approved = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    #[SignalMethod]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function reject()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $this-&gt;rejected = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute($imagePath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $safe = yield from $this-&gt;check($imagePath);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (! $safe) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            yield from $this-&gt;unsafe($imagePath);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return &#x27;unsafe&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        yield from $this-&gt;moderate($imagePath);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return $this-&gt;approved ? &#x27;approved&#x27; : &#x27;rejected&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private function check($imagePath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return yield ActivityStub::make(AutomatedImageCheckActivity::class, $imagePath);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private function unsafe($imagePath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        yield ActivityStub::all([</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ActivityStub::make(LogUnsafeImageActivity::class, $imagePath),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ActivityStub::make(DeleteImageActivity::class, $imagePath),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private function moderate($imagePath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        while (true) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            yield ActivityStub::make(NotifyImageModeratorActivity::class, $imagePath);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            $signaled = yield WorkflowStub::awaitWithTimeout(&#x27;24 hours&#x27;, fn () =&gt; $this-&gt;approved || $this-&gt;rejected);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if ($signaled) break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="activities">Activities<a class="hash-link" href="#activities" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automated-image-check">Automated Image Check<a class="hash-link" href="#automated-image-check" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Workflows;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use App\Services\ClarifAI;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Support\Facades\Storage;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Activity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class AutomatedImageCheckActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute($imagePath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return app(ClarifAI::class)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            -&gt;checkImage(Storage::get($imagePath));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="logging-unsafe-images">Logging Unsafe Images<a class="hash-link" href="#logging-unsafe-images" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Workflows;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Support\Facades\Log;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Activity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class LogUnsafeImageActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute($imagePath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Log::info(&#x27;Unsafe image detected at: &#x27; . $imagePath);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deleting-images">Deleting Images<a class="hash-link" href="#deleting-images" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Workflows;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Illuminate\Support\Facades\Storage;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Activity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class DeleteImageActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute($imagePath)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Storage::delete($imagePath);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="starting-and-signaling-the-workflow">Starting and Signaling the Workflow<a class="hash-link" href="#starting-and-signaling-the-workflow" title="Direct link to heading">​</a></h2><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$workflow = WorkflowStub::make(ImageModerationWorkflow::class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$workflow-&gt;start(&#x27;tmp/good.jpg&#x27;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For approvals or rejections:</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$workflow = WorkflowStub::load($id);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$workflow-&gt;approve();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// or</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$workflow-&gt;reject();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p><a href="https://github.com/laravel-workflow/laravel-workflow" target="_blank" rel="noopener noreferrer">Laravel Workflow</a> provides a structured approach to handle complex processes like image moderation. It supports asynchronous processing, external API integrations, and modular design for scalability. Thanks for reading!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ai">ai</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/image-moderation">image-moderation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/workflow">workflow</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/automation">automation</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/microservice-communication-with-laravel-workflow">Microservice Communication with Laravel Workflow</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-08-18T00:00:00.000Z" itemprop="datePublished">August 18, 2023</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/rmcdaniel.png" alt="Richard"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/rmcdaniel" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Richard</span></a></div><small class="avatar__subtitle" itemprop="description">Core Team</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nCy08NPtCpERqC09SVBFfg.jpeg" alt="captionless image" class="img_ev3q"></p><p>In the evolving landscape of microservices, communication has always been a focal point. Microservices can interact in various ways, be it through HTTP/REST calls, using messaging protocols like RabbitMQ or Kafka, or even employing more recent technologies like gRPC. Yet, regardless of the communication method, the goal remains the same: seamless, efficient, and robust interactions. Today, we’ll explore how Laravel Workflow can fit into this picture and optimize the communication between microservices in a unique way.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-challenge">The Challenge<a class="hash-link" href="#the-challenge" title="Direct link to heading">​</a></h2><p>In a microservices architecture, decoupling is the name of the game. You want each service to have a single responsibility, to be maintainable, and to be independently deployable. Yet, in the world of workflows, this becomes challenging. How do you split a workflow from its activity and yet ensure they communicate seamlessly?</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="laravel-workflow-to-the-rescue">Laravel Workflow to the Rescue!<a class="hash-link" href="#laravel-workflow-to-the-rescue" title="Direct link to heading">​</a></h2><p><a href="https://github.com/laravel-workflow/laravel-workflow" target="_blank" rel="noopener noreferrer">Laravel Workflow</a> handles the discovery and orchestration for you! With a shared database and queue connection, you can have your workflow in one Laravel app and its activity logic in another.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="defining-workflows-and-activities">Defining Workflows and Activities<a class="hash-link" href="#defining-workflows-and-activities" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-create-a-workflow">1. Create a workflow.<a class="hash-link" href="#1-create-a-workflow" title="Direct link to heading">​</a></h4><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\ActivityStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Workflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class MyWorkflow extends Workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute($name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $result = yield ActivityStub::make(MyActivity::class, $name);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return $result;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-an-activity">2. Create an activity.<a class="hash-link" href="#2-create-an-activity" title="Direct link to heading">​</a></h4><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Activity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class MyActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute($name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return &quot;Hello, {$name}!&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-run-the-workflow">3. Run the workflow.<a class="hash-link" href="#3-run-the-workflow" title="Direct link to heading">​</a></h4><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\WorkflowStub;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$workflow = WorkflowStub::make(MyWorkflow::class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$workflow-&gt;start(&#x27;world&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">while ($workflow-&gt;running());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$workflow-&gt;output();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Output: &#x27;Hello, world!&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The workflow will manage the activity and handle any failures, retries, etc. Think of workflows like job chaining on steroids because you can have conditional logic, loops, return a result that can be used in the next activity, and write everything in typical PHP code that is failure tolerant.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="balancing-shared-and-dedicated-resources">Balancing Shared and Dedicated Resources<a class="hash-link" href="#balancing-shared-and-dedicated-resources" title="Direct link to heading">​</a></h2><p>When working with microservices, it’s common for each service to have its dedicated resources, such as databases, caches, and queues. However, to facilitate communication between workflows and activities across services, a shared connection (like a database or queue) becomes essential. This shared connection acts as a bridge for data and task exchanges while ensuring:</p><ol><li><strong>Isolation</strong>: Dedicated resources prevent cascading failures.</li><li><strong>Performance</strong>: Each service can be optimized independently.</li><li><strong>Security</strong>: Isolation limits potential attack vectors.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-by-step-integration">Step-By-Step Integration<a class="hash-link" href="#step-by-step-integration" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-install-laravel-workflow-in-all-microservices">1. Install <code>laravel-workflow</code> in all microservices.<a class="hash-link" href="#1-install-laravel-workflow-in-all-microservices" title="Direct link to heading">​</a></h3><p>Follow the <a href="https://laravel-workflow.com/docs/installation/" target="_blank" rel="noopener noreferrer">installation guide</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-a-shared-databaseredis-connection-in-all-microservices">2. Create a shared database/redis connection in all microservices.<a class="hash-link" href="#2-create-a-shared-databaseredis-connection-in-all-microservices" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// config/database.php</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&#x27;connections&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;shared&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;driver&#x27; =&gt; &#x27;mysql&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;host&#x27; =&gt; env(&#x27;SHARED_DB_HOST&#x27;, &#x27;127.0.0.1&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;database&#x27; =&gt; env(&#x27;SHARED_DB_DATABASE&#x27;, &#x27;forge&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;username&#x27; =&gt; env(&#x27;SHARED_DB_USERNAME&#x27;, &#x27;forge&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;password&#x27; =&gt; env(&#x27;SHARED_DB_PASSWORD&#x27;, &#x27;&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">],</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-configure-a-shared-queue-connection">3. Configure a shared queue connection.<a class="hash-link" href="#3-configure-a-shared-queue-connection" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// config/queue.php</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&#x27;connections&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;shared&#x27; =&gt; [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;driver&#x27; =&gt; &#x27;redis&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;connection&#x27; =&gt; &#x27;shared&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &#x27;queue&#x27; =&gt; env(&#x27;SHARED_REDIS_QUEUE&#x27;, &#x27;default&#x27;),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">],</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-ensure-only-one-microservice-publishes-laravel-workflow-migrations">4. Ensure only one microservice publishes Laravel Workflow migrations.<a class="hash-link" href="#4-ensure-only-one-microservice-publishes-laravel-workflow-migrations" title="Direct link to heading">​</a></h3><p>Update the migration to use the shared database connection.</p><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// database/migrations/..._create_workflows_table.php</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class CreateWorkflowsTable extends Migration</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected $connection = &#x27;shared&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-extend-workflow-models-in-each-microservice-to-use-the-shared-connection">5. Extend workflow models in each microservice to use the shared connection.<a class="hash-link" href="#5-extend-workflow-models-in-each-microservice-to-use-the-shared-connection" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// app/Models/StoredWorkflow.php</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">namespace App\Models;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">use Workflow\Models\StoredWorkflow as BaseStoredWorkflow;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class StoredWorkflow extends BaseStoredWorkflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    protected $connection = &#x27;shared&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-publish-laravel-workflow-config-and-update-it-with-shared-models">6. Publish Laravel Workflow config and update it with shared models.<a class="hash-link" href="#6-publish-laravel-workflow-config-and-update-it-with-shared-models" title="Direct link to heading">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan vendor:publish --provider=&quot;Workflow\Providers\WorkflowServiceProvider&quot; --tag=&quot;config&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-set-workflows-and-activities-to-use-the-shared-queue">7. Set workflows and activities to use the shared queue.<a class="hash-link" href="#7-set-workflows-and-activities-to-use-the-shared-queue" title="Direct link to heading">​</a></h3><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// app/Workflows/MyWorkflow.php</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class MyWorkflow extends Workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $connection = &#x27;shared&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $queue = &#x27;workflow&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// app/Workflows/MyActivity.php</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class MyActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $connection = &#x27;shared&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $queue = &#x27;activity&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-ensure-microservices-define-empty-counterparts-for-workflow-and-activity-classes">8. Ensure microservices define empty counterparts for workflow and activity classes.<a class="hash-link" href="#8-ensure-microservices-define-empty-counterparts-for-workflow-and-activity-classes" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="in-the-workflow-microservice">In the workflow microservice:<a class="hash-link" href="#in-the-workflow-microservice" title="Direct link to heading">​</a></h4><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class MyWorkflow extends Workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $connection = &#x27;shared&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $queue = &#x27;workflow&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute($name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        yield ActivityStub::make(MyActivity::class, $name);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class MyActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $connection = &#x27;shared&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $queue = &#x27;activity&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="in-the-activity-microservice">In the activity microservice:<a class="hash-link" href="#in-the-activity-microservice" title="Direct link to heading">​</a></h4><div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class MyWorkflow extends Workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $connection = &#x27;shared&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $queue = &#x27;workflow&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class MyActivity extends Activity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $connection = &#x27;shared&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public $queue = &#x27;activity&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public function execute($name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return &quot;Hello, {$name}!&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-ensure-all-microservices-have-the-same-app_key-in-their-env-file">9. Ensure all microservices have the same <code>APP_KEY</code> in their <code>.env</code> file.<a class="hash-link" href="#9-ensure-all-microservices-have-the-same-app_key-in-their-env-file" title="Direct link to heading">​</a></h3><p>This is crucial for proper job serialization across services.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="10-run-queue-workers-in-each-microservice">10. Run queue workers in each microservice.<a class="hash-link" href="#10-run-queue-workers-in-each-microservice" title="Direct link to heading">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan queue:work shared --queue=workflow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">php artisan queue:work shared --queue=activity</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>By following the steps above, you can ensure seamless interactions between microservices while maintaining modularity and scalability. Laravel Workflow takes care of the discovery and orchestration for you. 🚀</p><p>Thanks for reading!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/microservices">microservices</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/workflow">workflow</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/communication">communication</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/distributed-systems">distributed-systems</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Installation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/xu5aDDpqVy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/laravelworkflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/laravel-workflow/laravel-workflow" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 <a href="https://laravel-workflow.com">Workflow</a>.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c6ba24a7.js"></script>
<script src="/assets/js/main.8562ac8d.js"></script>
</body>
</html>