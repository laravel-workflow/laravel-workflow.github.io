"use strict";(self.webpackChunklaravel_workflow=self.webpackChunklaravel_workflow||[]).push([[8044],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),u=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(i.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,f=d["".concat(i,".").concat(m)]||d[m]||p[m]||o;return n?r.createElement(f,l(l({ref:t},c),{},{components:n})):r.createElement(f,l({ref:t},c))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[d]="string"==typeof e?e:a,l[1]=s;for(var u=2;u<o;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},360:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>y,contentTitle:()=>m,default:()=>h,frontMatter:()=>p,metadata:()=>f,toc:()=>g});var r=n(7462),a=n(7294),o=n(3905);const l={simulatorWrapper:"simulatorWrapper_DmRV",expandButton:"expandButton_GZ0U",expanded:"expanded_Jf0H",expandIcon:"expandIcon_nmMz",simulatorContainer:"simulatorContainer_lbdE",slideDown:"slideDown_YuFf",simulatorHeader:"simulatorHeader_fTl5",simulatorTitle:"simulatorTitle_msH8",controls:"controls_ez90",playButton:"playButton_yOpM",resetButton:"resetButton_w3A6",codeContainer:"codeContainer_sR5c",codeBlock:"codeBlock_mjE8",codeLine:"codeLine_CkCc",highlighted:"highlighted_rwOl",waiting:"waiting_WCik",waitingPulse:"waitingPulse_Jky4",queryHighlight:"queryHighlight_i_IA",lineNumber:"lineNumber_mut9",lineContent:"lineContent_T2t4",waitingBadge:"waitingBadge_z52p",pulse:"pulse_NgPb",actionsRow:"actionsRow_g41A",querySection:"querySection_k4KC",queryButton:"queryButton_FxXR",queryResultInline:"queryResultInline__gOf",signalSection:"signalSection_qytd",signalButton:"signalButton_m9In",statusBar:"statusBar_i2GA",statusIndicator:"statusIndicator_gCKR",idle:"idle_C4V9",running:"running_l0dA",completed:"completed_xhEL",stateDisplay:"stateDisplay_SS9u"},s="idle",i="running",u="waiting",c="completed";function d(e){let{code:t="use function Workflow\\await;\nuse Workflow\\QueryMethod;\nuse Workflow\\SignalMethod;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    private bool $ready = false;\n\n    #[QueryMethod]\n    public function getReady(): bool\n    {\n        return $this->ready;\n    }\n\n    #[SignalMethod]\n    public function setReady($ready)\n    {\n        $this->ready = $ready;\n    }\n\n    public function execute()\n    {\n        yield await(fn () => $this->ready);\n    }\n}",title:n="Query & Signal Simulator"}=e;const[r,o]=(0,a.useState)(!1),[d,p]=(0,a.useState)(s),[m,f]=(0,a.useState)(-1),[y,g]=(0,a.useState)(0),[w,h]=(0,a.useState)(!1),[k,b]=(0,a.useState)(null),[v,x]=(0,a.useState)(!1),E=(0,a.useRef)(null),N=(0,a.useRef)(null),_=t.split("\n"),O=()=>{p(s),f(-1),g(0),h(!1),b(null),x(!1),E.current&&clearInterval(E.current),N.current&&cancelAnimationFrame(N.current)};return(0,a.useEffect)((()=>()=>{E.current&&clearInterval(E.current),N.current&&cancelAnimationFrame(N.current)}),[]),a.createElement("div",{className:l.simulatorWrapper},a.createElement("button",{className:`${l.expandButton} ${r?l.expanded:""}`,onClick:()=>o(!r)},a.createElement("span",{className:l.expandIcon},r?"\u25bc":"\u25b6"),a.createElement("span",null,"Try it out!")),r&&a.createElement("div",{className:l.simulatorContainer},a.createElement("div",{className:l.simulatorHeader},a.createElement("h4",{className:l.simulatorTitle},n),a.createElement("div",{className:l.controls},a.createElement("button",{className:l.playButton,onClick:()=>{O(),p(u),f(24);const e=Date.now();E.current=setInterval((()=>{g(Math.floor((Date.now()-e)/1e3))}),1e3)},disabled:d===i||d===u},d===i?"\u23f3 Running...":d===u?"\u23f8\ufe0f Waiting...":"\u25b6 Play"),a.createElement("button",{className:l.resetButton,onClick:O,disabled:d===i},"\ud83d\udd04 Reset"))),a.createElement("div",{className:l.codeContainer},a.createElement("pre",{className:l.codeBlock},_.map(((e,t)=>{const n=t+1,r=m===n,o=r&&d===u,s=v&&n>=10&&n<=14;return a.createElement("div",{key:t,className:`${l.codeLine} ${r?l.highlighted:""} ${o?l.waiting:""} ${s?l.queryHighlight:""}`},a.createElement("span",{className:l.lineNumber},n),a.createElement("span",{className:l.lineContent},e||" "),o&&a.createElement("span",{className:l.waitingBadge},y,"s"))})))),a.createElement("div",{className:l.actionsRow},(d===u||d===c)&&a.createElement("div",{className:l.querySection},a.createElement("button",{className:l.queryButton,onClick:()=>{x(!0),b(w),setTimeout((()=>{x(!1)}),500)}},"\ud83d\udd0d Query: ",a.createElement("code",null,"getReady()")),null!==k&&a.createElement("span",{className:l.queryResultInline},"\u2192 ",a.createElement("code",null,k?"true":"false"))),d===u&&a.createElement("div",{className:l.signalSection},a.createElement("button",{className:l.signalButton,onClick:()=>{d===u&&(E.current&&clearInterval(E.current),f(19),h(!0),p(i),setTimeout((()=>{f(24),setTimeout((()=>{p(c),f(-1)}),500)}),300))}},"\ud83d\udce4 Send Signal: ",a.createElement("code",null,"setReady(true)")))),a.createElement("div",{className:l.statusBar},a.createElement("span",{className:`${l.statusIndicator} ${l[d]}`},d===s&&"\u23f8\ufe0f Ready",d===i&&"\u25b6\ufe0f Running",d===u&&"\u23f3 Waiting for Signal",d===c&&"\u2705 Completed"),a.createElement("span",{className:l.stateDisplay},"$ready = ",a.createElement("code",null,w?"true":"false")))))}const p={sidebar_position:2},m="Queries",f={unversionedId:"features/queries",id:"features/queries",title:"Queries",description:"Queries allow you to retrieve information about the current state of a workflow without affecting its execution. This is useful for monitoring and debugging purposes.",source:"@site/docs/features/queries.md",sourceDirName:"features",slug:"/features/queries",permalink:"/docs/features/queries",draft:!1,editUrl:"https://github.com/laravel-workflow/laravel-workflow.github.io/edit/main/docs/features/queries.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Signals",permalink:"/docs/features/signals"},next:{title:"Timers",permalink:"/docs/features/timers"}},y={},g=[{value:"Outbox",id:"outbox",level:2}],w={toc:g};function h(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},w,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"queries"},"Queries"),(0,o.kt)("p",null,"Queries allow you to retrieve information about the current state of a workflow without affecting its execution. This is useful for monitoring and debugging purposes."),(0,o.kt)("p",null,"To define a query method on a workflow, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"QueryMethod")," annotation:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use Workflow\\QueryMethod;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    private bool $ready = false;\n\n    #[QueryMethod]\n    public function getReady(): bool\n    {\n        return $this->ready;\n    }\n}\n")),(0,o.kt)("p",null,"To query a workflow, call the method on the workflow instance. The query method will return the data from the workflow."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use Workflow\\WorkflowStub;\n\n$workflow = WorkflowStub::load($workflowId);\n\n$ready = $workflow->getReady();\n")),(0,o.kt)(d,{mdxType:"QuerySimulator"}),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Important:")," Querying a workflow does not advance its execution, unlike signals."),(0,o.kt)("h1",{id:"updates"},"Updates"),(0,o.kt)("p",null,"Updates allow you to retrieve information about the current state of a workflow and mutate the workflow state at the same time. They are essentially both a query and a signal combined into one."),(0,o.kt)("p",null,"To define an update method on a workflow, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"UpdateMethod")," annotation:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use Workflow\\UpdateMethod;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    private bool $ready = false;\n\n    #[UpdateMethod]\n    public function updateReady($ready): bool\n    {\n        $this->ready = $ready;\n\n        return $this->ready;\n    }\n}\n")),(0,o.kt)("h2",{id:"outbox"},"Outbox"),(0,o.kt)("p",null,"The outbox collects outgoing query messages and lets you produce them exactly once, even if the workflow is replayed or resumed multiple times."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},'use Workflow\\UpdateMethod;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    #[UpdateMethod]\n    public function receive()\n    {\n        if ($this->outbox->hasUnsent()) {\n            return $this->outbox->nextUnsent();\n        }\n    }\n\n    public function execute()\n    {\n        $count = 0;\n        while (true) {\n            $count++;\n\n            $this->outbox->send("Message {$count}");\n        }\n    }\n}\n')),(0,o.kt)("p",null,"Each sent signal is stored in the outbox. The outbox tracks which messages have already been sent. On replay, previously read messages remain sent. Only unsent messages are returned by ",(0,o.kt)("inlineCode",{parentName:"p"},"nextUnsent()"),". This makes the outbox safe to send multiple messages inside long-running loops."))}h.isMDXComponent=!0}}]);