"use strict";(self.webpackChunklaravel_workflow=self.webpackChunklaravel_workflow||[]).push([[1168],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>y});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=i,y=p["".concat(s,".").concat(m)]||p[m]||d[m]||r;return n?a.createElement(y,o(o({ref:t},u),{},{components:n})):a.createElement(y,o({ref:t},u))}));function y(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:i,o[1]=l;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},913:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>f,contentTitle:()=>m,default:()=>g,frontMatter:()=>d,metadata:()=>y,toc:()=>h});var a=n(7462),i=n(7294),r=n(3905);const o={simulatorWrapper:"simulatorWrapper_DAbD",expandButton:"expandButton_KV_6",expanded:"expanded_y30R",expandIcon:"expandIcon_IfB6",simulatorContainer:"simulatorContainer_XheI",slideDown:"slideDown_LbWe",simulatorHeader:"simulatorHeader_GdA2",simulatorTitle:"simulatorTitle_kTcN",controls:"controls_unnZ",playButton:"playButton_dejH",resetButton:"resetButton_i4OM",activitiesContainer:"activitiesContainer_aNvx",activityContainer:"activityContainer_xfZW",activityHeader:"activityHeader_iLrP",activityName:"activityName_na1H",activityStatus:"activityStatus_ccCy",pending:"pending_X9Hf",running:"running_GQmP",completed:"completed_A5W7",progressBarContainer:"progressBarContainer_pYm9",progressBar:"progressBar_nrrA",activityDuration:"activityDuration_eT2T",modeIndicator:"modeIndicator_PXow"},l="pending",s="running",c="completed";function u(e){let{name:t,status:n,progress:a,duration:r}=e;return i.createElement("div",{className:o.activityContainer},i.createElement("div",{className:o.activityHeader},i.createElement("span",{className:o.activityName},t),i.createElement("span",{className:`${o.activityStatus} ${o[n]}`},n===l&&"\u23f3 Pending",n===s&&"\u25b6\ufe0f Running",n===c&&"\u2705 Completed")),i.createElement("div",{className:o.progressBarContainer},i.createElement("div",{className:`${o.progressBar} ${o[n]}`,style:{width:`${a}%`}})),i.createElement("div",{className:o.activityDuration},n===c?`${r}ms`:n===s?`${Math.round(a)}%`:""))}function p(e){let{activities:t=[{name:"MyActivity1",duration:1500},{name:"MyActivity2",duration:2e3},{name:"MyActivity3",duration:1200}],mode:n="series",title:a="Series Execution"}=e;const[r,p]=(0,i.useState)(!1),[d,m]=(0,i.useState)(!1),[y,f]=(0,i.useState)(t.map((()=>({status:l,progress:0})))),h=(0,i.useRef)(null),v=(0,i.useRef)(null),g=()=>{f(t.map((()=>({status:l,progress:0})))),m(!1),h.current&&cancelAnimationFrame(h.current)};return(0,i.useEffect)((()=>()=>{h.current&&cancelAnimationFrame(h.current)}),[]),(0,i.useEffect)((()=>{f(t.map((()=>({status:l,progress:0}))))}),[t]),i.createElement("div",{className:o.simulatorWrapper},i.createElement("button",{className:`${o.expandButton} ${r?o.expanded:""}`,onClick:()=>p(!r)},i.createElement("span",{className:o.expandIcon},r?"\u25bc":"\u25b6"),i.createElement("span",null,"Try it out!")),r&&i.createElement("div",{className:o.simulatorContainer},i.createElement("div",{className:o.simulatorHeader},i.createElement("h4",{className:o.simulatorTitle},a),i.createElement("div",{className:o.controls},i.createElement("button",{className:o.playButton,onClick:()=>{"series"===n?(()=>{g(),m(!0),v.current=performance.now();let e=0,n=v.current;const a=i=>{if(e>=t.length)return void m(!1);const r=t[e],o=i-n,l=Math.min(o/r.duration*100,100);f((t=>{const n=[...t];for(let a=0;a<e;a++)n[a]={status:c,progress:100};return n[e]={status:l>=100?c:s,progress:l},n})),l>=100&&(e++,n=i),e<t.length?h.current=requestAnimationFrame(a):m(!1)};h.current=requestAnimationFrame(a)})():"mix"===n?(()=>{g(),m(!0);const e={};t.forEach(((t,n)=>{const a=t.group??n;e[a]||(e[a]=[]),e[a].push({...t,originalIndex:n})}));const n=Object.keys(e).sort(((e,t)=>e-t));let a=0,i=performance.now();const r={},o=t=>{if(a>=n.length)return void m(!1);const u=e[n[a]],p=t-i;let d=!0;f((t=>{const i=[...t];for(let r=0;r<a;r++)e[n[r]].forEach((e=>{i[e.originalIndex]={status:c,progress:100}}));const o={},m=[];return u.forEach((e=>{void 0!==e.subgroup?(o[e.subgroup]||(o[e.subgroup]=[]),o[e.subgroup].push(e)):m.push(e)})),m.forEach((e=>{const t=Math.min(p/e.duration*100,100);t<100&&(d=!1),i[e.originalIndex]={status:t>=100?c:s,progress:t}})),Object.keys(o).forEach((e=>{const t=o[e],n=`${a}-${e}`;void 0===r[n]&&(r[n]=0);let u=p,m=0;for(let a=0;a<t.length&&u>=t[a].duration;a++)u-=t[a].duration,m=a+1;for(let a=0;a<t.length;a++){const e=t[a];if(a<m)i[e.originalIndex]={status:c,progress:100};else if(a===m){const t=Math.min(u/e.duration*100,100);i[e.originalIndex]={status:t>=100?c:s,progress:t},t<100&&(d=!1)}else i[e.originalIndex]={status:l,progress:0},d=!1}})),i})),d&&(a++,i=t),a<n.length?h.current=requestAnimationFrame(o):(f((e=>e.map((()=>({status:c,progress:100}))))),m(!1))};h.current=requestAnimationFrame(o)})():(()=>{g(),m(!0),v.current=performance.now();const e=n=>{const a=n-v.current;let i=!0;f((e=>t.map(((e,t)=>{const n=Math.min(a/e.duration*100,100);return n<100&&(i=!1),{status:n>=100?c:s,progress:n}})))),i?m(!1):h.current=requestAnimationFrame(e)};h.current=requestAnimationFrame(e)})()},disabled:d},d?"\u23f3 Running...":"\u25b6 Play"),i.createElement("button",{className:o.resetButton,onClick:g,disabled:d},"\ud83d\udd04 Reset"))),i.createElement("div",{className:o.activitiesContainer},t.map(((e,t)=>i.createElement(u,{key:t,name:e.name,status:y[t]?.status||l,progress:y[t]?.progress||0,duration:e.duration})))),i.createElement("div",{className:o.modeIndicator},"Mode: ",i.createElement("strong",null,"series"===n?"Series (Sequential)":"mix"===n?"Mix (Series + Parallel)":"Parallel (Concurrent)"))))}const d={sidebar_position:8},m="Concurrency",y={unversionedId:"features/concurrency",id:"features/concurrency",title:"Concurrency",description:"Activities can be executed in series or in parallel. In either case, you start by using activity() to create a new instance of an activity and return a promise that represents the execution of that activity. The activity will immediately begin executing in the background. You can then yield this promise to pause the execution of the workflow and wait for the result of the activity, or pass the promise into the all() method to wait for a group of activities to complete in parallel.",source:"@site/docs/features/concurrency.md",sourceDirName:"features",slug:"/features/concurrency",permalink:"/docs/features/concurrency",draft:!1,editUrl:"https://github.com/laravel-workflow/laravel-workflow.github.io/edit/main/docs/features/concurrency.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Child Workflows",permalink:"/docs/features/child-workflows"},next:{title:"Sagas",permalink:"/docs/features/sagas"}},f={},h=[{value:"Series",id:"series",level:2},{value:"Parallel",id:"parallel",level:2},{value:"Mix and Match",id:"mix-and-match",level:2},{value:"Child Workflows in Parallel",id:"child-workflows-in-parallel",level:2}],v={toc:h};function g(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},v,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"concurrency"},"Concurrency"),(0,r.kt)("p",null,"Activities can be executed in series or in parallel. In either case, you start by using ",(0,r.kt)("inlineCode",{parentName:"p"},"activity()")," to create a new instance of an activity and return a promise that represents the execution of that activity. The activity will immediately begin executing in the background. You can then ",(0,r.kt)("inlineCode",{parentName:"p"},"yield")," this promise to pause the execution of the workflow and wait for the result of the activity, or pass the promise into the ",(0,r.kt)("inlineCode",{parentName:"p"},"all()")," method to wait for a group of activities to complete in parallel."),(0,r.kt)("h2",{id:"series"},"Series"),(0,r.kt)("p",null,"This example will execute 3 activities in series, waiting for the completion of each activity before continuing to the next one."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"use function Workflow\\activity;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    public function execute()\n    {\n        return [\n            yield activity(MyActivity1::class),\n            yield activity(MyActivity2::class),\n            yield activity(MyActivity3::class),\n        ];\n    }\n}\n")),(0,r.kt)(p,{activities:[{name:"MyActivity1",duration:1500},{name:"MyActivity2",duration:2e3},{name:"MyActivity3",duration:1200}],mode:"series",title:"Series Execution Simulator",mdxType:"ConcurrencySimulator"}),(0,r.kt)("h2",{id:"parallel"},"Parallel"),(0,r.kt)("p",null,"This example will execute 3 activities in parallel, waiting for the completion of all activities and collecting the results."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"use function Workflow\\{activity, all};\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    public function execute()\n    {\n        return yield all([\n            activity(MyActivity1::class),\n            activity(MyActivity2::class),\n            activity(MyActivity3::class),\n        ]);\n    }\n}\n")),(0,r.kt)(p,{activities:[{name:"MyActivity1",duration:2e3},{name:"MyActivity2",duration:1500},{name:"MyActivity3",duration:2500}],mode:"parallel",title:"Parallel Execution Simulator",mdxType:"ConcurrencySimulator"}),(0,r.kt)("p",null,"The main difference between the serial example and the parallel execution example is the number of ",(0,r.kt)("inlineCode",{parentName:"p"},"yield")," statements. In the serial example, there are 3 ",(0,r.kt)("inlineCode",{parentName:"p"},"yield")," statements, one for each activity. This means that the workflow will pause and wait for each activity to complete before continuing to the next one. In the parallel example, there is only 1 ",(0,r.kt)("inlineCode",{parentName:"p"},"yield")," statement, which wraps all of the activities in a call to ",(0,r.kt)("inlineCode",{parentName:"p"},"all()"),". This means that all of the activities will be executed in parallel, and the workflow will pause and wait for all of them to complete as a group before continuing."),(0,r.kt)("h2",{id:"mix-and-match"},"Mix and Match"),(0,r.kt)("p",null,"You can also mix serial and parallel executions as desired."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"use function Workflow\\{activity, all, async};\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    public function execute()\n    {\n        return [\n            yield activity(MyActivity1::class),\n            yield all([\n                async(fn () => [\n                    yield activity(MyActivity2::class),\n                    yield activity(MyActivity3::class),\n                ]),\n                activity(MyActivity4::class),\n                activity(MyActivity5::class),\n            ]),\n            yield activity(MyActivity6::class),\n        ];\n    }\n}\n")),(0,r.kt)(p,{activities:[{name:"MyActivity1",duration:1200,group:0},{name:"MyActivity2",duration:1e3,group:1,subgroup:"a"},{name:"MyActivity3",duration:1200,group:1,subgroup:"a"},{name:"MyActivity4",duration:1800,group:1},{name:"MyActivity5",duration:1400,group:1},{name:"MyActivity6",duration:1e3,group:2}],mode:"mix",title:"Mix and Match Simulator",mdxType:"ConcurrencySimulator"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://mermaid.live/edit#pako:eNpVUstuwjAQ_JVozwElthMFHyrR0h6qREKUUxsOLjHEamIjx2lLEf9e54XMnjyzM7NeyxfYq4IDhUOlfvYl08bbrnKZS8_W8iM7L_dGfAtzDncT27SfR81Opbd-_Ni0svGE9NZMs6ri1W6QdFUIza1XSS_dTNY7e_r8sr0FvHEteOPYu0pD5wJo581mD16KHA47Bi4Ld0xGHB1xdFnkNKKxMZrHtYdBoYsycoeiSZuinnh1MuMxMyNDa0TRhMCHoxYFUKNb7kPNdc06CJdOmYMpec1zoPZYMP2VQy6v1nNi8l2perJp1R5LoAdWNRa1p4IZvhLMPm19Y7Vdi-sn1UoDNFqQPgToBX6B4jCZLyJbQYiCJMbYhzPQEAfzmJAFIihGBCdXH_76oZZGuKcICTBCSeIDL4RROhv-T_-Nrv-BIKzD"},(0,r.kt)("img",{parentName:"a",src:"https://mermaid.ink/img/pako:eNpVUstuwjAQ_JVozwElthMFHyrR0h6qREKUUxsOLjHEamIjx2lLEf9e54XMnjyzM7NeyxfYq4IDhUOlfvYl08bbrnKZS8_W8iM7L_dGfAtzDncT27SfR81Opbd-_Ni0svGE9NZMs6ri1W6QdFUIza1XSS_dTNY7e_r8sr0FvHEteOPYu0pD5wJo581mD16KHA47Bi4Ld0xGHB1xdFnkNKKxMZrHtYdBoYsycoeiSZuinnh1MuMxMyNDa0TRhMCHoxYFUKNb7kPNdc06CJdOmYMpec1zoPZYMP2VQy6v1nNi8l2perJp1R5LoAdWNRa1p4IZvhLMPm19Y7Vdi-sn1UoDNFqQPgToBX6B4jCZLyJbQYiCJMbYhzPQEAfzmJAFIihGBCdXH_76oZZGuKcICTBCSeIDL4RROhv-T_-Nrv-BIKzD?type=png",alt:null}))),(0,r.kt)("p",null,"Activity 1 will execute and complete before any other activities start. Activities 2 and 3 will execute in series, waiting for each to complete one after another before continuing. At the same time, activities 4 and 5 will execute together in parallel and only when they all complete will execution continue. Finally, activity 6 executes last after all others have completed."),(0,r.kt)("h2",{id:"child-workflows-in-parallel"},"Child Workflows in Parallel"),(0,r.kt)("p",null,"You can pass child workflows to ",(0,r.kt)("inlineCode",{parentName:"p"},"all()")," along with other activities. It works the same way as parallel activity execution, but for child workflows. It allows you to fan out multiple child workflows and wait for all of them to complete together."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"use function Workflow\\{all, child};\n\n$results = yield all([\n    child(MyChild1::class),\n    child(MyChild2::class),\n    child(MyChild3::class),\n]);\n")),(0,r.kt)(p,{activities:[{name:"MyChild1",duration:2200},{name:"MyChild2",duration:1800},{name:"MyChild3",duration:2500}],mode:"parallel",title:"Child Workflows in Parallel Simulator",mdxType:"ConcurrencySimulator"}),(0,r.kt)("p",null,"This makes it easy to build hierarchical parallelism into your workflows."))}g.isMDXComponent=!0}}]);