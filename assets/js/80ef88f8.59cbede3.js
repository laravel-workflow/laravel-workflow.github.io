"use strict";(self.webpackChunklaravel_workflow=self.webpackChunklaravel_workflow||[]).push([[187],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>f});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),u=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=u(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(t),m=r,f=d["".concat(s,".").concat(m)]||d[m]||p[m]||o;return t?a.createElement(f,i(i({ref:n},c),{},{components:t})):a.createElement(f,i({ref:n},c))}));function f(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=t[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},7538:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>g,contentTitle:()=>m,default:()=>k,frontMatter:()=>p,metadata:()=>f,toc:()=>w});var a=t(7462),r=t(7294),o=t(3905);const i={simulatorWrapper:"simulatorWrapper_TDtD",expandButton:"expandButton_VOoA",expanded:"expanded_Wx_Q",expandIcon:"expandIcon_u5uA",simulatorContainer:"simulatorContainer_hyD1",slideDown:"slideDown__jb5",simulatorHeader:"simulatorHeader_npKx",simulatorTitle:"simulatorTitle_MsC4",controls:"controls_TXYH",playButton:"playButton_ewzj",resetButton:"resetButton_fZ8P",codeContainer:"codeContainer_Ps5T",codeBlock:"codeBlock_bTxV",codeLine:"codeLine_tPgC",highlighted:"highlighted_Zs13",waiting:"waiting_vaZ0",waitingPulse:"waitingPulse_mUun",lineNumber:"lineNumber_CHCq",lineContent:"lineContent_mPbr",waitingBadge:"waitingBadge_OpiZ",pulse:"pulse_wSvu",signalSection:"signalSection_seZ2",signalMessage:"signalMessage_IaDq",signalIcon:"signalIcon_O6kN",signalWave:"signalWave_k2cI",signalButton:"signalButton_MSOO",progressSection:"progressSection_yo8A",progressLabel:"progressLabel_WHQE",progressBarContainer:"progressBarContainer_Qhux",progressBar:"progressBar_oRIR",statusBar:"statusBar_vS8e",statusIndicator:"statusIndicator_WA40",idle:"idle_tR73",running:"running_e6NZ",completed:"completed_e5NM"},l="idle",s="running",u="waiting",c="completed";function d(e){let{code:n="use function Workflow\\await;\nuse Workflow\\SignalMethod;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    private $ready = false;\n\n    #[SignalMethod]\n    public function setReady($ready)\n    {\n        $this->ready = $ready;\n    }\n\n    public function execute()\n    {\n        yield await(fn () => $this->ready);\n    }\n}",steps:t=[{line:17,duration:0,label:"yield await(fn () => $this->ready)",type:"wait"},{line:12,duration:300,label:"$this->ready = $ready",type:"signal"},{line:17,duration:500,label:"await() condition satisfied",type:"run"}],signalName:a="setReady(true)",title:o="Signal Execution Simulator"}=e;const[d,p]=(0,r.useState)(!1),[m,f]=(0,r.useState)(l),[g,w]=(0,r.useState)(-1),[h,k]=(0,r.useState)(0),[y,b]=(0,r.useState)(0),v=(0,r.useRef)(null),x=(0,r.useRef)(null),N=n.split("\n"),S=()=>{f(l),w(-1),k(0),b(0),v.current&&cancelAnimationFrame(v.current),x.current&&clearInterval(x.current)},_=e=>{if(e>=t.length)return f(c),void w(-1);const n=t[e];if(w(e),"wait"===n.type){f(u),k(0);const e=Date.now();return void(x.current=setInterval((()=>{b(Math.floor((Date.now()-e)/1e3))}),1e3))}const a=performance.now(),r=t=>{const o=t-a,i=Math.min(o/n.duration*100,100);k(i),o<n.duration?v.current=requestAnimationFrame(r):_(e+1)};n.duration>0?v.current=requestAnimationFrame(r):_(e+1)};(0,r.useEffect)((()=>()=>{v.current&&cancelAnimationFrame(v.current),x.current&&clearInterval(x.current)}),[]);return r.createElement("div",{className:i.simulatorWrapper},r.createElement("button",{className:`${i.expandButton} ${d?i.expanded:""}`,onClick:()=>p(!d)},r.createElement("span",{className:i.expandIcon},d?"\u25bc":"\u25b6"),r.createElement("span",null,"Try it out!")),d&&r.createElement("div",{className:i.simulatorContainer},r.createElement("div",{className:i.simulatorHeader},r.createElement("h4",{className:i.simulatorTitle},o),r.createElement("div",{className:i.controls},r.createElement("button",{className:i.playButton,onClick:()=>{S(),f(s),_(0)},disabled:m===s||m===u},m===s?"\u23f3 Running...":m===u?"\u23f8\ufe0f Waiting...":"\u25b6 Play"),r.createElement("button",{className:i.resetButton,onClick:S,disabled:m===s},"\ud83d\udd04 Reset"))),r.createElement("div",{className:i.codeContainer},r.createElement("pre",{className:i.codeBlock},N.map(((e,n)=>{const a=n+1,o=g>=0&&g<t.length?t[g]:null,l=o&&o.line===a,s=l&&m===u;return r.createElement("div",{key:n,className:`${i.codeLine} ${l?i.highlighted:""} ${s?i.waiting:""}`},r.createElement("span",{className:i.lineNumber},a),r.createElement("span",{className:i.lineContent},e||" "),s&&r.createElement("span",{className:i.waitingBadge},y,"s"))})))),m===u&&r.createElement("div",{className:i.signalSection},r.createElement("button",{className:i.signalButton,onClick:()=>{if(m!==u)return;x.current&&clearInterval(x.current),f(s);_(g+1)}},"\ud83d\udce4 Send Signal: ",r.createElement("code",null,a))),r.createElement("div",{className:i.statusBar},r.createElement("span",{className:`${i.statusIndicator} ${i[m]}`},m===l&&"\u23f8\ufe0f Ready",m===s&&"\u25b6\ufe0f Running",m===u&&"\u23f3 Waiting for Signal",m===c&&"\u2705 Completed"))))}const p={sidebar_position:1},m="Signals",f={unversionedId:"features/signals",id:"features/signals",title:"Signals",description:"Signals allow you to trigger events in a workflow from outside the workflow. This can be useful for reacting to external events, enabling human-in-the-loop interventions, or for signaling the completion of an external task.",source:"@site/docs/features/signals.md",sourceDirName:"features",slug:"/features/signals",permalink:"/docs/features/signals",draft:!1,editUrl:"https://github.com/laravel-workflow/laravel-workflow.github.io/edit/main/docs/features/signals.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Features",permalink:"/docs/category/features"},next:{title:"Queries",permalink:"/docs/features/queries"}},g={},w=[{value:"Inbox",id:"inbox",level:2}],h={toc:w};function k(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,a.Z)({},h,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"signals"},"Signals"),(0,o.kt)("p",null,"Signals allow you to trigger events in a workflow from outside the workflow. This can be useful for reacting to external events, enabling ",(0,o.kt)("em",{parentName:"p"},"human-in-the-loop")," interventions, or for signaling the completion of an external task."),(0,o.kt)("p",null,"To define a signal method on your workflow, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"SignalMethod")," annotation. The method will be called with any arguments provided when the signal is triggered:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use Workflow\\SignalMethod;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    private $ready = false;\n\n    #[SignalMethod]\n    public function setReady($ready)\n    {\n        $this->ready = $ready;\n    }\n}\n")),(0,o.kt)("p",null,"To trigger a signal on a workflow, call the method on the workflow instance. The signal method accepts optional arguments that will also be passed to it."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use Workflow\\WorkflowStub;\n\n$workflow = WorkflowStub::load($workflowId);\n\n$workflow->setReady(true);\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"await()")," function can be used in a workflow to pause execution until a specified condition is met. For example, to pause the workflow until a signal is received, the following code can be used:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use function Workflow\\await;\nuse Workflow\\SignalMethod;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    private $ready = false;\n\n    #[SignalMethod]\n    public function setReady($ready)\n    {\n        $this->ready = $ready;\n    }\n\n    public function execute()\n    {\n        yield await(fn () => $this->ready);\n    }\n}\n")),(0,o.kt)(d,{mdxType:"SignalSimulator"}),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Important:")," The ",(0,o.kt)("inlineCode",{parentName:"p"},"await()")," function should only be used in a workflow, not an activity."),(0,o.kt)("h2",{id:"inbox"},"Inbox"),(0,o.kt)("p",null,"Workflows often need to handle multiple incoming signals over time. To solve this, workflows include a built-in replay-safe ",(0,o.kt)("inlineCode",{parentName:"p"},"$this->inbox"),"."),(0,o.kt)("p",null,"The inbox collects incoming signal values and lets you consume them exactly once, even if the workflow is replayed or resumed multiple times."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use function Workflow\\await;\nuse Workflow\\SignalMethod;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    #[SignalMethod]\n    public function send(string $message): void\n    {\n        $this->inbox->receive($message);\n    }\n\n    public function execute()\n    {\n        while (true) {\n            yield await(fn () => $this->inbox->hasUnread());\n\n            $message = $this->inbox->nextUnread();\n        }\n    }\n}\n")),(0,o.kt)("p",null,"Each received signal is stored in the inbox. The inbox tracks which messages have already been read. On replay, previously read messages remain read. Only unread messages are returned by ",(0,o.kt)("inlineCode",{parentName:"p"},"nextUnread()"),". This makes the inbox safe to use in ",(0,o.kt)("inlineCode",{parentName:"p"},"await()")," conditions and inside long-running loops."))}k.isMDXComponent=!0}}]);