"use strict";(self.webpackChunklaravel_workflow=self.webpackChunklaravel_workflow||[]).push([[2746],{3905:(e,t,n)=>{n.d(t,{Zo:()=>f,kt:()=>w});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},f=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,f=l(e,["components","mdxType","originalType","parentName"]),d=c(n),p=o,w=d["".concat(s,".").concat(p)]||d[p]||u[p]||i;return n?r.createElement(w,a(a({ref:t},f),{},{components:n})):r.createElement(w,a({ref:t},f))}));function w(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,a[1]=l;for(var c=2;c<i;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},9616:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=n(7462),o=(n(7294),n(3905));const i={sidebar_position:6},a="Side Effects",l={unversionedId:"features/side-effects",id:"features/side-effects",title:"Side Effects",description:"A side effect is a closure containing non-deterministic code. The closure is only executed once and the result is saved. It will not execute again if the workflow is retried. Instead, it will return the saved result. This makes the workflow deterministic because replaying the workflow will always return the same stored value rather than re-running the non-deterministic code.",source:"@site/docs/features/side-effects.md",sourceDirName:"features",slug:"/features/side-effects",permalink:"/docs/features/side-effects",draft:!1,editUrl:"https://github.com/durable-workflow/durable-workflow.github.io/edit/main/docs/features/side-effects.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Heartbeats",permalink:"/docs/features/heartbeats"},next:{title:"Child Workflows",permalink:"/docs/features/child-workflows"}},s={},c=[{value:"Signals and Control Flow",id:"signals-and-control-flow",level:2}],f={toc:c};function d(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"side-effects"},"Side Effects"),(0,o.kt)("p",null,"A side effect is a closure containing non-deterministic code. The closure is only executed once and the result is saved. It will not execute again if the workflow is retried. Instead, it will return the saved result. This makes the workflow deterministic because replaying the workflow will always return the same stored value rather than re-running the non-deterministic code."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use function Workflow\\{sideEffect, timer};\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    public function execute()\n    {\n        $seconds = yield sideEffect(fn () => random_int(60, 120));\n\n        yield timer($seconds);\n    }\n}\n")),(0,o.kt)("p",null,"The workflow will only call ",(0,o.kt)("inlineCode",{parentName:"p"},"random_int()")," once and save the result, even if the workflow later fails and is retried."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Important:")," The code inside a side effect should never fail because it will not be retried. Code that can possibly fail and therefore need to be retried should be moved to an activity instead."),(0,o.kt)("h2",{id:"signals-and-control-flow"},"Signals and Control Flow"),(0,o.kt)("p",null,"Signals are applied before the workflow continues execution. That means a signal-mutated variable can break replays unless the control flow decision is recorded deterministically."),(0,o.kt)("p",null,"Use ",(0,o.kt)("inlineCode",{parentName:"p"},"sideEffect()")," to snapshot any signal-driven branch decision:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use function Workflow\\{activity, sideEffect};\nuse Exception;\nuse Workflow\\SignalMethod;\nuse Workflow\\Workflow;\n\nclass MyWorkflow extends Workflow\n{\n    private bool $cancelled = false;\n\n    #[SignalMethod]\n    public function cancel()\n    {\n        $this->cancelled = true;\n    }\n\n    public function execute()\n    {\n        while (true) {\n            yield activity(MyActivity::class);\n\n            if (yield sideEffect(fn () => $this->cancelled)) {\n                throw new Exception('Workflow cancelled by signal.');\n            }\n        }\n    }\n")),(0,o.kt)("p",null,"This keeps control flow replay-safe and avoids non-deterministic branching during signal handling."))}d.isMDXComponent=!0}}]);