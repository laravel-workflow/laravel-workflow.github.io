"use strict";(self.webpackChunklaravel_workflow=self.webpackChunklaravel_workflow||[]).push([[651],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>b});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(a),p=r,b=m["".concat(l,".").concat(p)]||m[p]||d[p]||i;return a?n.createElement(b,o(o({ref:t},u),{},{components:a})):n.createElement(b,o({ref:t},u))}));function b(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:r,o[1]=s;for(var c=2;c<i;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},2139:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>f,contentTitle:()=>p,default:()=>y,frontMatter:()=>d,metadata:()=>b,toc:()=>h});var n=a(7462),r=a(7294),i=a(3905);const o={simulatorWrapper:"simulatorWrapper_sX3E",expandButton:"expandButton_eHXo",expanded:"expanded__jfy",expandIcon:"expandIcon_cKWM",simulatorContainer:"simulatorContainer_Hupd",slideDown:"slideDown_LV0Z",simulatorHeader:"simulatorHeader_Qbxr",simulatorTitle:"simulatorTitle_eLVD",controls:"controls_hdWl",playButton:"playButton_BiWL",stopButton:"stopButton_ka9J",resetButton:"resetButton_c2cp",modeSelector:"modeSelector_O7H_",modeButton:"modeButton_MvR0",active:"active_OMUp",codeContainer:"codeContainer_LbFr",codeBlock:"codeBlock_lbpd",codeLine:"codeLine_OBhx",highlighted:"highlighted_WNjZ",lineNumber:"lineNumber_opwT",lineContent:"lineContent_gDAw",statsSection:"statsSection_qZ__",statRow:"statRow_gXWU",statLabel:"statLabel_YHFa",statValue:"statValue_l1IT",timeoutSection:"timeoutSection_m8o6",timeoutLabel:"timeoutLabel_jh42",timeoutBarContainer:"timeoutBarContainer_Hg9s",timeoutBar:"timeoutBar_djn1",danger:"danger_ZB7D",statusBar:"statusBar_OQK_",statusIndicator:"statusIndicator_vfqZ",idle:"idle_Ws1U",running:"running_LQjB",completed:"completed_DvDu",failed:"failed_p4oC",heartbeatIndicator:"heartbeatIndicator_B_kQ",heartbeat:"heartbeat_SQHX"},s="idle",l="running",c="completed",u="failed";function m(e){let{title:t="Heartbeat Simulator"}=e;const[a,n]=(0,r.useState)(!1),[i,m]=(0,r.useState)(!0),[d,p]=(0,r.useState)(s),[b,f]=(0,r.useState)(-1),[h,v]=(0,r.useState)(0),[y,g]=(0,r.useState)(0),[w,E]=(0,r.useState)(0),_=(0,r.useRef)(null),N=(0,r.useRef)(null),k=(0,r.useRef)(null),B=(i?"use Workflow\\Activity;\n\nclass MyActivity extends Activity\n{\n    public $timeout = 5;\n\n    public function execute()\n    {\n      while (true) {\n        sleep(1);\n\n        $this->heartbeat();\n      }\n    }\n}":"use Workflow\\Activity;\n\nclass MyActivity extends Activity\n{\n    public $timeout = 5;\n\n    public function execute()\n    {\n      while (true) {\n        sleep(1);\n\n        // No heartbeat!\n      }\n    }\n}").split("\n"),x=()=>{p(s),f(-1),v(0),g(0),E(0),_.current&&cancelAnimationFrame(_.current)};(0,r.useEffect)((()=>()=>{_.current&&cancelAnimationFrame(_.current)}),[]),(0,r.useEffect)((()=>{x()}),[i]);const O=h-w,C=Math.min(O/5*100,100);return r.createElement("div",{className:o.simulatorWrapper},r.createElement("button",{className:`${o.expandButton} ${a?o.expanded:""}`,onClick:()=>n(!a)},r.createElement("span",{className:o.expandIcon},a?"\u25bc":"\u25b6"),r.createElement("span",null,"Try it out!")),a&&r.createElement("div",{className:o.simulatorContainer},r.createElement("div",{className:o.simulatorHeader},r.createElement("h4",{className:o.simulatorTitle},t),r.createElement("div",{className:o.controls},d===l?r.createElement("button",{className:o.stopButton,onClick:()=>{_.current&&cancelAnimationFrame(_.current),p(c),f(-1)}},"\u23f9 Stop"):r.createElement("button",{className:o.playButton,onClick:()=>{x(),p(l),N.current=performance.now(),k.current=performance.now();let e=0,t=0,a=0,n=performance.now();const r=o=>{const s=(o-N.current)/1e3;v(s);if(s-t>=5)return p(u),void f(-1);const l=o-n;0===a?(f(10),l>=1e3&&(a=1,n=o)):(f(12),l>=200&&(i&&(t=s,E(s)),e++,g(e),a=0,n=o)),_.current=requestAnimationFrame(r)};_.current=requestAnimationFrame(r)}},"\u25b6 Play"),r.createElement("button",{className:o.resetButton,onClick:x,disabled:d===l},"\ud83d\udd04 Reset"))),r.createElement("div",{className:o.modeSelector},r.createElement("button",{className:`${o.modeButton} ${i?o.active:""}`,onClick:()=>m(!0),disabled:d===l},"With Heartbeat"),r.createElement("button",{className:`${o.modeButton} ${i?"":o.active}`,onClick:()=>m(!1),disabled:d===l},"Without Heartbeat")),r.createElement("div",{className:o.codeContainer},r.createElement("pre",{className:o.codeBlock},B.map(((e,t)=>{const a=t+1,n=b===a;return r.createElement("div",{key:t,className:`${o.codeLine} ${n?o.highlighted:""}`},r.createElement("span",{className:o.lineNumber},a),r.createElement("span",{className:o.lineContent},e||" "))})))),d===l&&r.createElement("div",{className:o.statsSection},r.createElement("div",{className:o.statRow},r.createElement("span",{className:o.statLabel},"Loop iterations:"),r.createElement("span",{className:o.statValue},y)),r.createElement("div",{className:o.statRow},r.createElement("span",{className:o.statLabel},"Total time:"),r.createElement("span",{className:o.statValue},h.toFixed(1),"s")),r.createElement("div",{className:o.timeoutSection},r.createElement("div",{className:o.timeoutLabel},"Time since last heartbeat: ",r.createElement("strong",null,O.toFixed(1),"s")," / 5s timeout"),r.createElement("div",{className:o.timeoutBarContainer},r.createElement("div",{className:`${o.timeoutBar} ${C>80?o.danger:""}`,style:{width:`${C}%`}})))),r.createElement("div",{className:o.statusBar},r.createElement("span",{className:`${o.statusIndicator} ${o[d]}`},d===s&&"\u23f8\ufe0f Ready",d===l&&"\u25b6\ufe0f Running",d===c&&"\u2705 Completed",d===u&&"\u274c Timeout - No Heartbeat!"),d===l&&i&&r.createElement("span",{className:o.heartbeatIndicator},"\ud83d\udc93 Heartbeat active"))))}const d={sidebar_position:5},p="Heartbeats",b={unversionedId:"features/heartbeats",id:"features/heartbeats",title:"Heartbeats",description:"Heartbeats are sent at regular intervals to indicate that an activity is still running and hasn't frozen or crashed. They prevent the activity from being terminated due to timing out. This enables long-running activities to have a relatively low timeout. As long as the activity sends a heartbeat faster than the timeout duration, it will not be terminated.",source:"@site/docs/features/heartbeats.md",sourceDirName:"features",slug:"/features/heartbeats",permalink:"/docs/features/heartbeats",draft:!1,editUrl:"https://github.com/laravel-workflow/laravel-workflow.github.io/edit/main/docs/features/heartbeats.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Signal + Timer",permalink:"/docs/features/signal+timer"},next:{title:"Side Effects",permalink:"/docs/features/side-effects"}},f={},h=[],v={toc:h};function y(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},v,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"heartbeats"},"Heartbeats"),(0,i.kt)("p",null,"Heartbeats are sent at regular intervals to indicate that an activity is still running and hasn't frozen or crashed. They prevent the activity from being terminated due to timing out. This enables long-running activities to have a relatively low timeout. As long as the activity sends a heartbeat faster than the timeout duration, it will not be terminated."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use Workflow\\Activity;\n\nclass MyActivity extends Activity\n{\n    public $timeout = 5;\n\n    public function execute()\n    {\n      while (true) {\n        sleep(1);\n\n        $this->heartbeat();\n      }\n    }\n}\n")),(0,i.kt)(m,{mdxType:"HeartbeatSimulator"}),(0,i.kt)("p",null,"In the above example, even though the activity would normally be terminated after running for 5 seconds, the periodic heartbeat allows it to keep running. If the activity does freeze or crash then the heartbeat will stop and the timeout will be triggered."))}y.isMDXComponent=!0}}]);